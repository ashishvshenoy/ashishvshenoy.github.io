<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Project Stork ‚Äî Baby Reveal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 (UMD) + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel to transpile inline JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* small fix so emoji confetti doesn‚Äôt block clicks */
    .pointer-events-none { pointer-events: none; }
  </style>
</head>
<body class="min-h-screen">
  <!-- Background music element (looping). Update the src to your lullaby. -->
  <audio
  id="bg-music"
  src="/assets/audio/bg1.mp3"
  loop
  preload="auto"
  crossOrigin="anonymous"></audio>

  <div id="root"></div>

  <script type="text/babel">
    // IMPORTANT:
    // - This is your BabyReveal component adapted for CDN usage.
    // - No "import React" or "export default" ‚Äî React is global (window.React).
    // - Feel free to tweak CONFIG and the audio URLs below.

    // Nerdy Gender Announcement ‚Äî single-file React component (no external libs)
    const CONFIG = {
      parents: { partner1: "Ashish", partner2: "Meghna" },
      baby: { gender: "girl", due: "February 2026", codename: "Project Stork" },
      sfx: {
        // Optional baby SFX (coos/giggles) used in the terminal steps:
        // host files in your repo (e.g., /assets/audio/...) or leave blank to synthesize.
        cooUrl: "/assets/audio/baby-coo.mp3",
        giggleUrl: "/assets/audio/baby-giggle.mp3",
      }
    };

    // --- Cute baby ASCII artworks keyed by stage (use real newlines) ---
    const BABY_ASCII = {
      preflight: `   (·µî·¥•·µî)‚ô°
       /|  /|   heartbeat OK
      /_| /_|   diapers ready`,
      cloning:   `   ___   üïäÔ∏è
      /__ \\  stork en route
     (____) ) carrying code`,
      lint:      `  (‚Ä¢‚ó°‚Ä¢)  ‚ú®
      /|_ |_\\
      (___|___)  no lint, just lintels`,
      data:      `   (‚Ä¢·¥ó‚Ä¢)  üçº
      <)  )>  loading data
       /  \\   wiggle augment`,
      deps:      `  [üì¶][üçº][üß∏]
       (‚Ä¢‚Äø‚Ä¢) okies!`,
      seed:      `   üå±
      (‚Ä¢‚ó°‚Ä¢) set-seed 42`,
      compile:   `  (‚öôÔ∏è‚öôÔ∏è)
      (‚Ä¢_‚Ä¢) building snuggles`,
      cache:     `   ‚åÇ crib cache
      (‚Ä¢·¥ó‚Ä¢ )„Å§[blanket]`,
      train:     `  (‡∏á ‚Ä¢ÃÄ_‚Ä¢ÃÅ)‡∏á  rattle reps!
      [==  tiny gains  ==]`,
      eval:      `   üîé
      (‚Ä¢·¥ó‚Ä¢) metrics coo`,
      package:   `   üéÅ bundle-of-joy
      (‚Ä¢‚ó°‚Ä¢) ‚úì`
    };

    // Deterministic Baby Zoo mapping by stage (no rotation randomness)
    const BABY_ZOO = [
      `  (‚Ä¢·¥ó‚Ä¢)üçº
      /)  )  bottle bot
      /  /`,
      `   _
     _( )_  teddy guard
    (_ . _)
      /_\\`,
      `  (‚Ä¢”©‚Ä¢)  duckling dev
      <)  )=
       "  "`,
      `  (‚Ä¢·¥ó‚Ä¢)  rattle ops
      /|  |\\
      /_|__|_\\`,
      `   ___  stork CI
      <(o )__
        ( ._ )>`
    ];
    const STAGE2ZOO = {
      preflight: 1, cloning: 4, lint: 3, data: 2, deps: 0, seed: 2, compile: 3, cache: 1,
      train: 0, eval: 2, package: 4, countdown: 1, idle: 1,
    };

    // --- Countdown ASCII (5 ‚Üí 1 ‚Üí baby). Pure ASCII art ---
    const COUNTDOWN_ASCII = [
      // idx 5,4,3,2,1,0
      `  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
        ‚ñà‚ñà     
        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 
             ‚ñà‚ñà
        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  `,
      `     ‚ñà‚ñà
       ‚ñà  ‚ñà‚ñà‚ñà
         ‚ñà‚ñà  
         ‚ñà‚ñà  
      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà`,
      `  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
           ‚ñà‚ñà
        ‚ñà‚ñà‚ñà  
           ‚ñà‚ñà
        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  `,
      `   ‚ñà‚ñà‚ñà‚ñà
      ‚ñà‚ñà    ‚ñà‚ñà
           ‚ñà‚ñà
         ‚ñà‚ñà
      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà`,
      `     ‚ñà‚ñà
        ‚ñà‚ñà‚ñà‚ñà
          ‚ñà‚ñà
          ‚ñà‚ñà
         ‚ñà‚ñà‚ñà‚ñà`,
      `   (‚Ä¢·¥ó‚Ä¢)  
      ( ÔΩ°‚Ä¢ ÔΩ°)  baby time!
      /)   )
      /  ‚ô•  
      üë∂`
    ];

    // --- Sound Effects (Web Audio + optional <audio> samples) ---
    function useSfx(){
      const { useRef, useEffect } = React;
      const ctxRef = useRef(null);
      const unlockedRef = useRef(false);
      const cooRef = useRef(null);
      const giggleRef = useRef(null);

      useEffect(()=>()=>{ try{ ctxRef.current?.close(); }catch{} },[]);

      function ctx(){ if (!ctxRef.current){ const C = window.AudioContext||window.webkitAudioContext; if (C) ctxRef.current = new C(); } return ctxRef.current; }
      function ensure(){ const c = ctx(); if (!c) return false; if (c.state === 'suspended') c.resume(); unlockedRef.current = true; return true; }

      function tone({freq=600, dur=0.12, type='sine', vol=0.04}){ try{ const c=ctx(); if(!c||!unlockedRef.current) return; const o=c.createOscillator(); const g=c.createGain(); o.type=type; o.frequency.value=freq; g.gain.value=vol; o.connect(g); g.connect(c.destination); const t=c.currentTime; o.start(t); o.stop(t+dur);}catch{} }
      function sweep({from=400,to=900,dur=0.4,type='sine',vol=0.035}){ try{ const c=ctx(); if(!c||!unlockedRef.current) return; const o=c.createOscillator(); const g=c.createGain(); o.type=type; g.gain.value=vol; o.connect(g); g.connect(c.destination); const t=c.currentTime; o.frequency.setValueAtTime(from,t); o.frequency.linearRampToValueAtTime(to,t+dur); o.start(t); o.stop(t+dur);}catch{} }
      function noise({dur=0.2, vol=0.02}){ try{ const c=ctx(); if(!c||!unlockedRef.current) return; const buffer=c.createBuffer(1, c.sampleRate*dur, c.sampleRate); const data=buffer.getChannelData(0); for(let i=0;i<data.length;i++){ data[i] = (Math.random()*2-1)*0.4; } const src=c.createBufferSource(); const g=c.createGain(); g.gain.value=vol; src.buffer=buffer; src.connect(g); g.connect(c.destination); const t=c.currentTime; src.start(t); src.stop(t+dur);}catch{} }

      function playTag(tagRef){ try{ const el = tagRef.current; if (!el) return false; el.currentTime = 0; const p = el.play(); if (p && p.catch) p.catch(()=>{}); return true; }catch{ return false; } }

      return {
        attach(elCoo, elGiggle){ cooRef.current = elCoo; giggleRef.current = elGiggle; },
        unlock(){ return ensure(); },
        tick(){ tone({freq:520,dur:0.09,type:'triangle'}); },
        coo(){ if (!playTag(cooRef)) sweep({from:440,to:720,dur:0.5,type:'sine'}); },
        giggle(){ if (!playTag(giggleRef)) { sweep({from:700,to:900,dur:0.18,type:'triangle'}); setTimeout(()=>sweep({from:680,to:880,dur:0.18,type:'triangle'}),120); } },
        rattle(){ noise({dur:0.18, vol:0.03}); },
        chime(){ tone({freq:880,dur:0.16,type:'sine',vol:0.05}); setTimeout(()=>tone({freq:1175,dur:0.2,type:'sine',vol:0.05}),120); },
      };
    }

    // --- Helpers ---
    function clampProgress(p){ return Math.max(0, Math.min(100, Number.isFinite(p) ? p : 0)); }
    function useRafCount({ from = 0, to = 100, duration = 1500, easing = t => t, start = false, onDone }){
      const { useState, useEffect } = React;
      const [val, setVal] = useState(from);
      useEffect(() => {
        if (!start) return; let raf, t0;
        function frame(ts){ if (!t0) t0 = ts; const p = Math.min(1, (ts - t0) / duration); setVal(from + (to - from) * easing(p)); if (p < 1) raf = requestAnimationFrame(frame); else onDone && onDone(); }
        raf = requestAnimationFrame(frame); return () => cancelAnimationFrame(raf);
      }, [start, from, to, duration, easing, onDone]);
      return val;
    }
    const easeInOut = t => (t<.5? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2);

    function TopSoundBar({ soundReady, onEnable }) {
      return (
        <div className="sticky top-0 z-20 flex justify-end pt-3">
          {!soundReady && (
            <button
              onClick={onEnable}
              className="px-3 py-1 rounded-full border bg-emerald-600 text-white hover:bg-emerald-500 shadow"
              aria-label="Enable Sound"
            >
              üîä Enable sound
            </button>
          )}
        </div>
      );
    }

    // --- Component ---
    function BabyReveal() {
      const { useState, useEffect, useRef } = React;

      const [runningBuild, setRunningBuild] = useState(false);
      const [buildStatic, setBuildStatic] = useState([]); // array of {txt,s}
      const [buildCurrent, setBuildCurrent] = useState("");
      const [buildShow, setBuildShow] = useState(false);
      const [progressBuild, setProgressBuild] = useState(0);
      const [stage, setStage] = useState("idle");
      const [revealed, setRevealed] = useState(false);
      const [confettiOn, setConfettiOn] = useState(false);
      const [dark, setDark] = useState(false);
      const [epochCount, setEpochCount] = useState(0);
      const [countdown, setCountdown] = useState(null); // 5..0 or null
      const [soundReady, setSoundReady] = useState(false);

      useEffect(() => {
        const root = document.documentElement; if (!root) return;
        if (dark) root.classList.add('dark'); else root.classList.remove('dark');
      }, [dark]);

      const sfx = useSfx();
      const cooTag = useRef(null);
      const giggleTag = useRef(null);
      useEffect(()=>{ sfx.attach(cooTag.current, giggleTag.current); },[sfx]);

      const sequenceBuild = [
        { s: "preflight", txt: "$ preflight --check env,heart,home" },
        { s: "cloning",  txt: "$ git clone https://repo.life/" + CONFIG.baby.codename.toLowerCase() },
        { s: "cloning",  txt: "Cloning into '" + CONFIG.baby.codename + "'..." },
        { s: "lint",     txt: "$ eslint . --fix (nursery rules applied)" },
        { s: "data",     txt: "$ prepare_data --source=ultrasound --augment=wriggles,heartbeats" },
        { s: "deps",     txt: "$ npm install diapers pacifier swaddles --save" },
        { s: "deps",     txt: "audited 40 pacifiers ‚Äî 0 vulnerabilities (only adorableness)" },
        { s: "seed",     txt: "$ set-seed 42 (deterministically cute)" },
        { s: "compile",  txt: "$ compile-kernels --target=snuggleGPU" },
        { s: "cache",    txt: "$ warm-cache --crib --bottles" },
        { s: "train",    txt: "$ python train.py --epochs=5 --patience=‚àû" },
        { s: "train",    txt: "[Epoch 1/5] loss: 0.62 ‚Üí acc: 0.58 ‚Äî baseline coos" },
        { s: "train",    txt: "[Epoch 2/5] loss: 0.31 ‚Üí acc: 0.80 ‚Äî smiles detected" },
        { s: "train",    txt: "[Epoch 3/5] loss: 0.18 ‚Üí acc: 0.90 ‚Äî nap scheduler stabilized" },
        { s: "train",    txt: "[Epoch 4/5] loss: 0.10 ‚Üí acc: 0.96 ‚Äî overfit mode guarded with hugs" },
        { s: "train",    txt: "[Epoch 5/5] loss: 0.07 ‚Üí acc: 0.98 ‚Äî optimum cuddles achieved" },
        { s: "eval",     txt: "$ eval.py --metrics=F1,ROC-AUC,SnackScore" },
        { s: "eval",     txt: "ROC-AUC: 0.99 ‚Äî SnackScore: 11/10" },
        { s: "package",  txt: "$ package --format=bundle-of-joy" },
      ];

      function enableAllSound() {
        // Unlock WebAudio-based SFX
        const ok = sfx.unlock();
        setSoundReady(ok);

        // Start background music
        const bg = document.getElementById("bg-music");
        if (bg) {
          try {
            bg.currentTime = 0;
            bg.volume = 0.6; // adjust if you want softer/louder
            const p = bg.play();
            if (p && p.catch) p.catch(() => {});
          } catch {}
        }
      }

      function start() {
        if (runningBuild) return;
        setRunningBuild(true);
        setBuildStatic([]); setBuildCurrent(""); setBuildShow(false);
        setProgressBuild(0); setRevealed(false); setEpochCount(0); setCountdown(null);
        const ok = sfx.unlock(); setSoundReady(ok);
        // --- Fade in background music (from muted autoplay) ---
        const bg = document.getElementById("bg-music");
        if (bg) {
          try {
            bg.muted = false;        // unmute now that we have a user gesture
            const target = 0.6;      // final volume (0.0‚Äì1.0)
            const steps = 15;        // fade granularity
            const ms = 1500;         // fade duration
            const step = (target - (bg.volume || 0)) / steps;
            let i = 0;
            // ensure starting point (some browsers start at 1.0)
            bg.volume = 0.0;
            const fade = setInterval(() => {
              i++;
              bg.volume = Math.min(target, bg.volume + step);
              if (i >= steps) clearInterval(fade);
            }, Math.round(ms / steps));
            // make sure playback is running
            bg.play().catch(()=>{});
          } catch {}
        }
        runBuildSequence(0);
      }

      function runBuildSequence(idx){
        const total = sequenceBuild.length;
        if (idx >= total){ startCountdown(5); return; }
        const seg = sequenceBuild[idx]; setStage(seg.s);
        setProgressBuild(Math.round((idx/total)*100));
        const isEpoch = seg.s === 'train' && seg.txt.startsWith('[');
        if (isEpoch) { sfx.coo(); } else if (seg.s === 'package') { sfx.chime(); } else { sfx.tick(); }

        if (isEpoch){
          setBuildCurrent(seg.txt); setBuildShow(true);
          setHandleBuildTyped(() => () => {
            setProgressBuild(Math.round(((idx+1)/total)*100));
            setBuildStatic(prev => [...prev, { txt: seg.txt, s: seg.s }]);
            setEpochCount(c => Math.min(5, c+1));
            setBuildCurrent(""); setBuildShow(false);
            const nextSeg = sequenceBuild[idx+1];
            if (nextSeg && nextSeg.s === 'train' && nextSeg.txt.startsWith('[')){
              runBuildSequence(idx+1);
            } else {
              setTimeout(() => { setBuildStatic([]); }, 1000);
              setTimeout(() => runBuildSequence(idx+1), 1100);
            }
          });
          return;
        }
        setBuildCurrent(seg.txt); setBuildShow(true);
        setHandleBuildTyped(() => () => {
          setProgressBuild(Math.round(((idx+1)/total)*100));
          setTimeout(() => { setBuildShow(false); setBuildCurrent(""); }, 1000);
          setTimeout(() => runBuildSequence(idx+1), 1100);
        });
      }

      function startCountdown(n){
        setStage('countdown'); setCountdown(n);
        const step = (k) => {
          setCountdown(k);
          if (k === 0){ sfx.giggle(); setTimeout(()=> { sfx.chime(); finalizeReveal(); }, 180); return; }
          sfx.coo(); setTimeout(()=> step(k-1), 1000);
        };
        step(n);
      }

      function finalizeReveal(){
        setRunningBuild(false); setProgressBuild(100);
        setTimeout(() => {
          setRevealed(true); setConfettiOn(true);
          // Try to start background music after reveal; still requires user gesture on mobile unless they pressed Enable Sound earlier.
          const bg = document.getElementById('bg-music');
          if (bg) bg.play().catch(()=>{});
        }, 200);
      }

      const [handleBuildTyped, setHandleBuildTyped] = useState(() => () => {});
      const accuracy = useRafCount({ from: 0.6, to: 0.99, duration: 1800, easing: easeInOut, start: revealed });
      const loss     = useRafCount({ from: 1.2, to: 0.05, duration: 1800, easing: easeInOut, start: revealed });

      const bgClasses = revealed
        ? "bg-gradient-to-b from-rose-50 to-pink-100 dark:from-rose-950 dark:to-pink-950"
        : "bg-gradient-to-b from-stone-50 to-emerald-50 dark:from-black dark:to-zinc-950";

      return (
        <div className={"min-h-screen w-full relative " + bgClasses + " text-zinc-800 dark:text-zinc-100"}>
          <div className="relative max-w-4xl mx-auto px-4 py-10">
            <Header dark={dark} setDark={setDark} />
            <TopSoundBar soundReady={soundReady} onEnable={enableAllSound} />
            <Hero revealed={revealed} stage={stage} />

            <BuildProgress progress={progressBuild} stage={stage} />

            <Terminal
              title="build"
              staticLines={buildStatic}
              text={buildShow ? buildCurrent : ""}
              running={runningBuild}
              stage={stage}
              zooKey={STAGE2ZOO[stage] ?? 0}
              countdown={countdown}
              onRun={start}
              onTyped={handleBuildTyped}
            />

            {revealed && <RevealCard />}
            {revealed && (<ModelMetrics acc={accuracy} loss={loss} />)}
            {revealed && (<MetricsVisuals acc={accuracy} loss={loss} />)}

            <Controls />
            <Footer />

            {/* Hidden audio tags for epoch/reveal SFX */}
            <audio ref={cooTag} src={CONFIG.sfx.cooUrl || undefined} preload="auto" crossOrigin="anonymous" />
            <audio ref={giggleTag} src={CONFIG.sfx.giggleUrl || undefined} preload="auto" crossOrigin="anonymous" />
          </div>
          {confettiOn && <EmojiConfetti onDone={() => setConfettiOn(false)} />}
        </div>
      );
    }

    // ---------- UI Subcomponents ----------
    function Header({ dark, setDark }){
      return (
        <div className="flex items-center justify-between gap-4 mb-6">
          <div className="flex items-center gap-3">
            <span className="text-2xl">üë∂</span>
            <div>
              <h1 className="text-2xl font-extrabold tracking-tight">Hello world baby!</h1>
            </div>
          </div>
          <button
            className="rounded-full border px-3 py-1 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-800"
            onClick={() => setDark(d => !d)}
            aria-label="Toggle dark mode"
          >
            üåó Theme
          </button>
        </div>
      );
    }

    function Hero({ revealed, stage }){
      return (
        <div className="mb-6 rounded-2xl p-5 bg-gradient-to-r from-emerald-100 via-lime-100 to-amber-100 dark:from-emerald-900/20 dark:via-lime-900/20 dark:to-amber-900/20 border border-emerald-200/60 dark:border-emerald-700/40">
          <p className="text-sm uppercase tracking-widest opacity-70">Project Stork <span className="ml-2 text-xs px-2 py-0.5 rounded-full bg-white/70 dark:bg-zinc-900/40 border">{stage}</span></p>
          <h2 className="text-3xl md:text-4xl font-black leading-tight mt-1">
            {revealed ? (
              <span className="bg-clip-text text-transparent bg-gradient-to-r from-pink-600 via-rose-600 to-fuchsia-600">
                It‚Äôs a girl! üéâ
              </span>
            ) : (
              <>Deploying <span className="underline decoration-wavy decoration-emerald-600 underline-offset-4">something adorable</span>‚Ä¶</>
            )}
          </h2>
          <p className="mt-2 text-base opacity-80">
            Ashish & Meghna are thrilled to announce a new teammate arriving in February 2026.
          </p>
        </div>
      );
    }

    function Terminal({ title = "shell", staticLines = [], text, running, stage, zooKey = 0, countdown=null, onRun, onTyped }){
      const ascii = BABY_ASCII[stage] || '';
      const zooArt = BABY_ZOO[Math.max(0, Math.min(BABY_ZOO.length-1, zooKey))];
      const isEpochLine = stage === 'train' && typeof text === 'string' && text.startsWith('[');
      const isCountdown = stage === 'countdown' && (countdown !== null);
      const cdArt = countdown !== null ? (COUNTDOWN_ASCII[Math.max(0, Math.min(5, countdown))] || COUNTDOWN_ASCII[0]) : '';
      return (
        <div className="font-mono text-sm bg-zinc-950 text-zinc-50 rounded-2xl overflow-hidden border border-zinc-800 mb-6 shadow-lg">
          <div className="flex items-center gap-2 px-3 py-2 bg-zinc-900 border-b border-zinc-800">
            <span className="w-3 h-3 rounded-full bg-red-500" />
            <span className="w-3 h-3 rounded-full bg-yellow-400" />
            <span className="w-3 h-3 rounded-full bg-green-500" />
            <span className="ml-3 opacity-70">dev@parents: ~/projects/project-stork ({title})</span>
            <div className="flex-1" />
            {title === 'build' && (
              <button
                onClick={onRun}
                disabled={running}
                className={`px-3 py-1 rounded-md border transition-colors ${running ? "opacity-60 cursor-not-allowed bg-zinc-800/60 border-zinc-700" : "bg-emerald-600 border-emerald-700 text-white hover:bg-emerald-500"}`}
              >
                {running ? "Running‚Ä¶" : "Run Reveal ‚ñ∂"}
              </button>
            )}
          </div>
          <div className="p-4 min-h-[260px] space-y-3">
            {staticLines.map((l, i) => {
              const isEpoch = typeof l === 'object' && l.s === 'train' && typeof l.txt === 'string' && l.txt.startsWith('[');
              return (
                <div key={i} className="opacity-90">
                  <div>{typeof l === 'string' ? l : l.txt}</div>
                  {!isEpoch && <pre className="opacity-70 whitespace-pre leading-4 mt-1">{BABY_ASCII[typeof l === 'string' ? 'train' : l.s] || ''}</pre>}
                  {!isEpoch && <pre className="opacity-60 whitespace-pre leading-4 mt-1">{zooArt}</pre>}
                </div>
              );
            })}
            {isCountdown && (<pre className="text-2xl whitespace-pre leading-6 select-none">{cdArt}</pre>)}
            {!isCountdown && text ? (
              <div>
                <TypeLine text={text} onDone={onTyped} />
                {!isEpochLine && <pre className="opacity-70 whitespace-pre leading-4 mt-1">{ascii}</pre>}
                {!isEpochLine && <pre className="opacity-60 whitespace-pre leading-4 mt-1">{zooArt}</pre>}
              </div>
            ) : (!isCountdown && (staticLines.length === 0 ? <div className="opacity-20 select-none"></div> : null))}
          </div>
        </div>
      );
    }

    function TypeLine({ text, onDone }){
      const { useState, useEffect } = React;
      const [display, setDisplay] = useState("");
      useEffect(() => {
        setDisplay(""); let i = 0;
        const id = setInterval(() => {
          i++; setDisplay(text.slice(0, i));
          if (i >= text.length) { clearInterval(id); onDone && onDone(); }
        }, 64);
        return () => clearInterval(id);
      }, [text, onDone]);
      return <div className="whitespace-pre-wrap"><span>{display}</span><span className="animate-pulse">‚ñç</span></div>;
    }

    function BuildProgress({ progress, stage }){
      const value = clampProgress(progress);
      const label = { preflight: "preflight", cloning: "clone", lint: "lint", data: "data", deps: "deps", seed: "seed", compile: "compile", cache: "cache", train: "train", eval: "eval", package: "package", countdown: "countdown", idle: "idle" }[stage || 'idle'];
      return (
        <div className="mb-6 rounded-xl border bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 p-4">
          <div className="flex items-center justify-between mb-2">
            <div className="font-semibold">Pipeline: <span className="uppercase">{label}</span></div>
            <div className="text-sm opacity-70">{Math.round(value)}%</div>
          </div>
          <div className="w-full h-3 rounded-full bg-zinc-200 dark:bg-zinc-800 overflow-hidden">
            <div className="h-full bg-gradient-to-r from-emerald-500 via-amber-500 to-lime-500" style={{ width: `${value}%`, backgroundSize: '200% 100%', animation: 'shimmer 3s linear infinite' }} />
          </div>
          <div className="mt-2 text-xs opacity-70">Stages: preflight ‚Üí clone ‚Üí lint ‚Üí data ‚Üí deps ‚Üí seed ‚Üí compile ‚Üí cache ‚Üí train ‚Üí eval ‚Üí package ‚Üí countdown</div>
          <style>{`@keyframes shimmer { 0%{ background-position: 0% 50% } 100%{ background-position: 100% 50% } }`}</style>
        </div>
      );
    }

    function RevealCard(){
      return (
        <div className="mb-6 rounded-2xl border bg-white dark:bg-zinc-950 border-pink-200 dark:border-pink-800/60 p-5">
          <div className="text-sm uppercase tracking-widest opacity-70">Release Notes</div>
          <h3 className="text-2xl font-black mt-1 bg-clip-text text-transparent bg-gradient-to-r from-pink-600 via-rose-600 to-fuchsia-600">It‚Äôs a GIRL! üéâ</h3>
          <ul className="mt-3 space-y-2 text-sm leading-6">
            <li>‚Ä¢ Feature: Tiny toes with enterprise-grade cuteness.</li>
            <li>‚Ä¢ Performance: 120 smiles/min at batch size 1.</li>
            <li>‚Ä¢ Generalization: Zero-shot grandparents support.</li>
            <li>‚Ä¢ Regularization: Extra hugs prevent overfitting to parents only.</li>
            <li>‚Ä¢ Explainability: Cry-to-snack attention maps.</li>
          </ul>
        </div>
      );
    }

    function ModelMetrics({ acc, loss }){
      return (
        <div className="grid md:grid-cols-3 gap-4 mb-8">
          <MetricCard label="Accuracy (smiles)" value={(acc*100).toFixed(1) + "%"} note="validated on family.dev" />
          <MetricCard label="Loss (tears)" value={loss.toFixed(2)} note="decreasing with cuddles" />
          <MetricCard label="F1 (Family-1)" value={((2*(acc)/(1+acc))*100).toFixed(1) + "%"} note="precision=hugs recall=snacks" />
        </div>
      );
    }
    function MetricCard({ label, value, note }){
      return (
        <div className="rounded-xl border bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 p-4">
          <div className="text-sm opacity-70">{label}</div>
          <div className="text-2xl font-black tracking-tight mt-1">{value}</div>
          <div className="text-xs opacity-70 mt-1">{note}</div>
        </div>
      );
    }

    // ---------- Fun Visualizations ----------
    function MetricsVisuals({ acc = 0.99, loss = 0.05 }){
      const pct = Math.max(0, Math.min(1, Number(acc) || 0));
      const lossN = Math.max(0, Math.min(1, Number(loss) || 0.5));
      return (
        <div className="grid md:grid-cols-3 gap-4 mb-10">
          <DonutCard label="Accuracy" value={pct} suffix="%" />
          <TearCard label="Loss" value={lossN} />
          <HeartMatrixCard label="Family-1 Confusion Matrix" acc={pct} />
        </div>
      );
    }
    function DonutCard({ label, value, suffix = "%" }){
      const perc = Math.round(value * 100);
      const r = 36, C = 2 * Math.PI * r;
      const off = C * (1 - value);
      return (
        <div className="rounded-xl border bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 p-4">
          <div className="text-sm opacity-70 mb-2">{label}</div>
          <div className="flex items-center justify-center">
            <svg width="120" height="120" viewBox="0 0 120 120">
              <defs>
                <linearGradient id="gradAcc" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stopColor="#10b981"/><stop offset="100%" stopColor="#f59e0b"/>
                </linearGradient>
              </defs>
              <circle cx="60" cy="60" r={r} stroke="#e5e7eb" strokeWidth="12" fill="none" />
              <circle cx="60" cy="60" r={r} stroke="url(#gradAcc)" strokeWidth="12" fill="none"
                      strokeDasharray={C} strokeDashoffset={off}
                      style={{ transition: 'stroke-dashoffset 1200ms ease' }}
                      transform="rotate(-90 60 60)"/>
              <text x="60" y="64" textAnchor="middle" className="fill-zinc-900 dark:fill-zinc-100" style={{fontWeight:800,fontSize:'20px'}}>{perc}{suffix}</text>
            </svg>
          </div>
          <div className="text-xs opacity-70 text-center">higher = more smiles detected</div>
        </div>
      );
    }
    function TearCard({ label, value }){
      const fill = Math.max(0, Math.min(1, 1 - value)); // lower loss => more fill
      return (
        <div className="rounded-xl border bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 p-4">
          <div className="text-sm opacity-70 mb-2">{label}</div>
          <div className="flex items-center justify-center">
            <svg width="120" height="120" viewBox="0 0 120 120">
              <defs>
                <linearGradient id="tearGrad" x1="0" y1="0" x2="0" y2="1">
                  <stop offset="0%" stopColor="#60a5fa"/><stop offset="100%" stopColor="#3b82f6"/>
                </linearGradient>
                <clipPath id="tearClip">
                  <path d="M60 16 C54 28 36 46 36 68 c0 14 10 30 24 30s24-16 24-30c0-22-18-40-24-52z" />
                </clipPath>
              </defs>
              <path d="M60 16 C54 28 36 46 36 68 c0 14 10 30 24 30s24-16 24-30c0-22-18-40-24-52z" fill="#1f2937" opacity="0.08" stroke="#2563eb" strokeWidth="2"/>
              <g clipPath="url(#tearClip)">
                <rect x="30" y={100 - 80*fill} width="60" height="80" fill="url(#tearGrad)" style={{ transition: 'y 1000ms ease,height 1000ms ease' }} />
              </g>
              <text x="60" y="112" textAnchor="middle" className="fill-zinc-600 dark:fill-zinc-300" style={{fontSize:'11px'}}>lower = fewer tears</text>
            </svg>
          </div>
        </div>
      );
    }
    function HeartMatrixCard({ label, acc=0.99 }){
      const tp = Math.round(100 * acc);
      const tn = Math.round(100 * acc * 0.9);
      const fp = 100 - tn;
      const fn = 100 - tp;
      const cell = (title, v, hue) => (
        <div className="flex flex-col items-center justify-center p-3 rounded-xl border bg-white/60 dark:bg-zinc-900/40 border-zinc-200 dark:border-zinc-800">
          <div className="text-xs opacity-70 mb-1">{title}</div>
          <div aria-hidden className="text-2xl" style={{filter:'drop-shadow(0 0 6px rgba(0,0,0,.08))'}}>
            <span style={{color:hue}}>‚ù§</span> √ó {v}
          </div>
        </div>
      );
      return (
        <div className="rounded-xl border bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 p-4">
          <div className="text-sm opacity-70 mb-2">{label}</div>
          <div className="grid grid-cols-2 gap-3">
            {cell('TP (smiles caught)', tp, '#ef4444')}
            {cell('FP (phantom coos)', fp, '#f59e0b')}
            {cell('FN (missed giggles)', fn, '#8b5cf6')}
            {cell('TN (silence ok)', tn, '#10b981')}
          </div>
          <div className="text-xs opacity-70 mt-2">Playful, not scientific ‚Äî but very adorable.</div>
        </div>
      );
    }

    function Controls(){
      return (
        <div className="mb-8 grid md:grid-cols-1 gap-3">
          <div className="rounded-xl border bg-white dark:bg-zinc-950 border-zinc-200 dark:border-zinc-800 p-3 text-sm opacity-80 flex items-center justify-between">
            <span className="text-xs opacity-70">(click ‚ÄúRun Reveal ‚ñ∂‚Äù to start)</span>
            {/* Sound controls moved to TopSoundBar */}
          </div>
        </div>
      );
    }

    function Footer(){
      return <div className="mt-12 text-xs opacity-70 text-center">Built with ‚ô• by two sleep-deprived engineers.</div>;
    }

    function EmojiConfetti({ onDone }){
      const { useState, useEffect } = React;
      const [pieces] = useState(() => {
        const base = 120;
        return Array.from({ length: base }, (_, i) => ({ id: i, left: Math.random() * 100, size: 14 + Math.random() * 22, delay: Math.random() * 0.8, duration: 2.8 + Math.random() * 1.8, rotate: (Math.random() * 2 - 1) * 200, emoji: ["üéâ","üíñ","üçº","üë∂","‚ú®","üéÄ","üß∏"][Math.floor(Math.random() * 7)], }));
      });
      useEffect(() => { const id = setTimeout(() => onDone?.(), 5200); return () => clearTimeout(id); }, [onDone]);
      return (
        <div className="pointer-events-none fixed inset-0 overflow-hidden">
          {pieces.map(p => (
            <span key={p.id} style={{ position: 'absolute', left: p.left + '%', top: '-10%', fontSize: p.size + 'px', transform: `rotate(${p.rotate}deg)`, animation: `fall ${p.duration}s ${p.delay}s ease-in forwards` }}>{p.emoji}</span>
          ))}
          <style>{`@keyframes fall { 0%{ transform: translateY(-10vh) rotate(0) } 100%{ transform: translateY(110vh) rotate(360deg) } }`}</style>
        </div>
      );
    }

    // Mount
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BabyReveal />);
  </script>
</body>
</html>
